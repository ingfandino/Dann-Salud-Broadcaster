module.exports=[47337,a=>{"use strict";let b=(0,a.i(3446).default)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);a.s(["Send",()=>b],47337)},61305,a=>{"use strict";let b=(0,a.i(3446).default)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);a.s(["Download",()=>b],61305)},70079,a=>{"use strict";let b=(0,a.i(3446).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);a.s(["ArrowLeft",()=>b],70079)},14747,(a,b,c)=>{b.exports=a.x("path",()=>require("path"))},83901,a=>{"use strict";let b=(0,a.i(3446).default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);a.s(["Trash2",()=>b],83901)},34155,a=>{"use strict";var b=a.i(47753),c=a.i(5504),d=a.i(19596),e=a.i(86326),f=a.i(72918),g=a.i(27584),h=a.i(22630),i=a.i(42568),j=a.i(37627),k=a.i(21410),l=a.i(30577);function m(){let{theme:a}=(0,d.useTheme)(),m=(0,l.useSocket)(),[n,o]=(0,c.useState)("inbox"),[p,q]=(0,c.useState)(null),[r,s]=(0,c.useState)(!1),[t,u]=(0,c.useState)(void 0),[v,w]=(0,c.useState)([]),[x,y]=(0,c.useState)(!0),[z,A]=(0,c.useState)({page:1,pages:1,total:0}),[B,C]=(0,c.useState)(0),[D,E]=(0,c.useState)([]);(0,c.useEffect)(()=>{F(),G()},[n,z.page]),(0,c.useEffect)(()=>(m&&(m.on("new_message",a=>{k.toast.info(`Nuevo mensaje de ${a.from.nombre}: ${a.subject}`),G(),"inbox"===n&&F()}),m.on("message_read",()=>{"sent"===n&&F()})),()=>{m&&(m.off("new_message"),m.off("message_read"))}),[m,n]);let F=async()=>{y(!0);try{let a,b={page:z.page,limit:20};"inbox"===n?a=await j.api.internalMessages.getInbox(b):"sent"===n?a=await j.api.internalMessages.getSent(b):"starred"===n&&(a=await j.api.internalMessages.getStarred(b)),a&&(w(a.data.messages),A(b=>({...b,pages:a.data.pagination.pages,total:a.data.pagination.total})))}catch(a){console.error("Error loading messages:",a),k.toast.error("Error al cargar mensajes")}finally{y(!1)}},G=async()=>{try{let a=await j.api.internalMessages.getUnreadCount();C(a.data.unreadCount)}catch(a){console.error("Error loading unread count:",a)}},H=async a=>{if("inbox"===n&&!a.read)try{await j.api.internalMessages.markAsRead(a._id,!0),C(a=>Math.max(0,a-1)),w(b=>b.map(b=>b._id===a._id?{...b,read:!0}:b)),a.read=!0}catch(a){console.error("Error marking as read:",a)}q(a)},I=async(a,b)=>{a.stopPropagation();try{await j.api.internalMessages.toggleStarred(b),w(a=>a.map(a=>a._id===b?{...a,starred:!a.starred}:a)),p?._id===b&&q(a=>a?{...a,starred:!a.starred}:null),"starred"===n&&F()}catch(a){console.error("Error toggling star:",a)}},J=async a=>{if(confirm(`\xbfEst\xe1 seguro de eliminar ${a.length} mensaje(s)?`))try{await Promise.all(a.map(a=>j.api.internalMessages.delete(a))),k.toast.success("Mensajes eliminados"),E([]),p&&a.includes(p._id)&&q(null),F()}catch(a){console.error("Error deleting messages:",a),k.toast.error("Error al eliminar mensajes")}},K=async()=>{if(confirm("¿Está seguro de eliminar TODOS los mensajes? Esta acción no se puede deshacer."))try{await j.api.internalMessages.deleteAll(),k.toast.success("Todos los mensajes eliminados"),E([]),F()}catch(a){console.error("Error deleting all messages:",a),k.toast.error("Error al eliminar todos los mensajes")}};return(0,b.jsxs)("div",{className:(0,e.cn)("h-[calc(100vh-8rem)] flex rounded-xl overflow-hidden border shadow-sm","dark"===a?"bg-[#1a1333] border-white/10":"bg-white border-gray-200"),children:[(0,b.jsx)(f.MessagesSidebar,{currentView:n,onViewChange:a=>{o(a),q(null),A({...z,page:1})},onCompose:()=>{u(void 0),s(!0)},unreadCount:B}),(0,b.jsx)("div",{className:"flex-1 flex flex-col min-w-0",children:p?(0,b.jsx)(h.MessageDetail,{message:p,onBack:()=>q(null),onReply:()=>{p&&(u({to:[p.from._id],subject:`RE: ${p.subject}`,replyTo:p._id,content:`

--- En respuesta a ---
Fecha: ${new Date(p.createdAt).toLocaleString()}
De: ${p.from.nombre}
Asunto: ${p.subject}

${p.content}`}),s(!0))},onForward:()=>{p&&(u({subject:`FW: ${p.subject}`,content:`

--- Mensaje reenviado ---
Fecha: ${new Date(p.createdAt).toLocaleString()}
De: ${p.from.nombre}
Asunto: ${p.subject}

${p.content}`,isForward:!0}),s(!0))},onDelete:()=>J([p._id]),onToggleStar:()=>I({stopPropagation:()=>{}},p._id)}):(0,b.jsx)(g.MessageList,{messages:v,loading:x,view:n,onSelectMessage:H,onToggleStar:I,onDelete:J,selectedIds:D,onToggleSelect:a=>{E(b=>b.includes(a)?b.filter(b=>b!==a):[...b,a])},onToggleSelectAll:()=>{D.length===v.length?E([]):E(v.map(a=>a._id))},onDeleteAll:K,pagination:z,onPageChange:a=>A(b=>({...b,page:a}))})}),(0,b.jsx)(i.ComposeModal,{isOpen:r,onClose:()=>s(!1),initialData:t,onSent:()=>{"sent"===n&&F()}})]})}a.s(["default",()=>m])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__a54700e8._.js.map