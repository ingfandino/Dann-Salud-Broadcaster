(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33121,e=>{"use strict";let a=(0,e.i(49163).default)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);e.s(["Download",()=>a],33121)},98275,e=>{"use strict";let a=(0,e.i(49163).default)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);e.s(["Send",()=>a],98275)},20927,e=>{"use strict";let a=(0,e.i(49163).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>a],20927)},51444,e=>{"use strict";let a=(0,e.i(49163).default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);e.s(["Trash2",()=>a],51444)},35947,e=>{"use strict";var a=e.i(13161),t=e.i(91447),s=e.i(72079),r=e.i(31981),o=e.i(35389),n=e.i(33133),i=e.i(29396),l=e.i(74402),d=e.i(32575),c=e.i(8950),g=e.i(8152);function u(){let{theme:e}=(0,s.useTheme)(),u=(0,g.useSocket)(),[m,p]=(0,t.useState)("inbox"),[h,f]=(0,t.useState)(null),[y,x]=(0,t.useState)(!1),[w,j]=(0,t.useState)(void 0),[S,b]=(0,t.useState)([]),[M,k]=(0,t.useState)(!0),[v,E]=(0,t.useState)({page:1,pages:1,total:0}),[_,T]=(0,t.useState)(0),[$,A]=(0,t.useState)([]);(0,t.useEffect)(()=>{D(),C()},[m,v.page]),(0,t.useEffect)(()=>(u&&(u.on("new_message",e=>{c.toast.info(`Nuevo mensaje de ${e.from.nombre}: ${e.subject}`),C(),"inbox"===m&&D()}),u.on("message_read",()=>{"sent"===m&&D()})),()=>{u&&(u.off("new_message"),u.off("message_read"))}),[u,m]);let D=async()=>{k(!0);try{let e,a={page:v.page,limit:20};"inbox"===m?e=await d.api.internalMessages.getInbox(a):"sent"===m?e=await d.api.internalMessages.getSent(a):"starred"===m&&(e=await d.api.internalMessages.getStarred(a)),e&&(b(e.data.messages),E(a=>({...a,pages:e.data.pagination.pages,total:e.data.pagination.total})))}catch(e){console.error("Error loading messages:",e),c.toast.error("Error al cargar mensajes")}finally{k(!1)}},C=async()=>{try{let e=await d.api.internalMessages.getUnreadCount();T(e.data.unreadCount)}catch(e){console.error("Error loading unread count:",e)}},P=async e=>{if("inbox"===m&&!e.read)try{await d.api.internalMessages.markAsRead(e._id,!0),T(e=>Math.max(0,e-1)),b(a=>a.map(a=>a._id===e._id?{...a,read:!0}:a)),e.read=!0}catch(e){console.error("Error marking as read:",e)}f(e)},F=async(e,a)=>{e.stopPropagation();try{await d.api.internalMessages.toggleStarred(a),b(e=>e.map(e=>e._id===a?{...e,starred:!e.starred}:e)),h?._id===a&&f(e=>e?{...e,starred:!e.starred}:null),"starred"===m&&D()}catch(e){console.error("Error toggling star:",e)}},L=async e=>{if(confirm(`\xbfEst\xe1 seguro de eliminar ${e.length} mensaje(s)?`))try{await Promise.all(e.map(e=>d.api.internalMessages.delete(e))),c.toast.success("Mensajes eliminados"),A([]),h&&e.includes(h._id)&&f(null),D()}catch(e){console.error("Error deleting messages:",e),c.toast.error("Error al eliminar mensajes")}},O=async()=>{if(confirm("¿Está seguro de eliminar TODOS los mensajes? Esta acción no se puede deshacer."))try{await d.api.internalMessages.deleteAll(),c.toast.success("Todos los mensajes eliminados"),A([]),D()}catch(e){console.error("Error deleting all messages:",e),c.toast.error("Error al eliminar todos los mensajes")}};return(0,a.jsxs)("div",{className:(0,r.cn)("h-[calc(100vh-8rem)] flex rounded-xl overflow-hidden border shadow-sm","dark"===e?"bg-[#1a1333] border-white/10":"bg-white border-gray-200"),children:[(0,a.jsx)(o.MessagesSidebar,{currentView:m,onViewChange:e=>{p(e),f(null),E({...v,page:1})},onCompose:()=>{j(void 0),x(!0)},unreadCount:_}),(0,a.jsx)("div",{className:"flex-1 flex flex-col min-w-0",children:h?(0,a.jsx)(i.MessageDetail,{message:h,onBack:()=>f(null),onReply:()=>{h&&(j({to:[h.from._id],subject:`RE: ${h.subject}`,replyTo:h._id,content:`

--- En respuesta a ---
Fecha: ${new Date(h.createdAt).toLocaleString()}
De: ${h.from.nombre}
Asunto: ${h.subject}

${h.content}`}),x(!0))},onForward:()=>{h&&(j({subject:`FW: ${h.subject}`,content:`

--- Mensaje reenviado ---
Fecha: ${new Date(h.createdAt).toLocaleString()}
De: ${h.from.nombre}
Asunto: ${h.subject}

${h.content}`,isForward:!0}),x(!0))},onDelete:()=>L([h._id]),onToggleStar:()=>F({stopPropagation:()=>{}},h._id)}):(0,a.jsx)(n.MessageList,{messages:S,loading:M,view:m,onSelectMessage:P,onToggleStar:F,onDelete:L,selectedIds:$,onToggleSelect:e=>{A(a=>a.includes(e)?a.filter(a=>a!==e):[...a,e])},onToggleSelectAll:()=>{$.length===S.length?A([]):A(S.map(e=>e._id))},onDeleteAll:O,pagination:v,onPageChange:e=>E(a=>({...a,page:e}))})}),(0,a.jsx)(l.ComposeModal,{isOpen:y,onClose:()=>x(!1),initialData:w,onSent:()=>{"sent"===m&&D()}})]})}e.s(["default",()=>u])}]);