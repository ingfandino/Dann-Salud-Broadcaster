(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,50400,92062,86470,e=>{"use strict";var a=e.i(49163);let t=(0,a.default)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);e.s(["Lock",()=>t],50400);let s=(0,a.default)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);e.s(["Filter",()=>s],92062);var r=e.i(32575);async function i(e){return(await r.default.get("/evidencias",{params:e})).data}async function l(e){return(await r.default.get("/evidencias/ventas-elegibles",{params:e})).data}async function d(e,a){let t=new FormData;return t.append("file",a),t.append("ventaId",e),(await r.default.post("/evidencias/upload",t,{headers:{"Content-Type":"multipart/form-data"}})).data}async function n(e){return(await r.default.patch(`/evidencias/${e}/complete`)).data}async function c(e,a){let t=new Blob([(await r.default.get(`/evidencias/${e}/download`,{responseType:"blob"})).data],{type:"application/zip"}),s=window.URL.createObjectURL(t),i=document.createElement("a");i.href=s,i.download=a||"evidencia.zip",document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(s)}e.s(["downloadZip",()=>c,"getEvidencias",()=>i,"getVentasElegibles",()=>l,"markAsComplete",()=>n,"uploadZip",()=>d],86470)},8554,e=>{"use strict";let a=(0,e.i(49163).default)("FileArchive",[["path",{d:"M10 12v-1",key:"v7bkov"}],["path",{d:"M10 18v-2",key:"1cjy8d"}],["path",{d:"M10 7V6",key:"dljcrl"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M15.5 22H18a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v16a2 2 0 0 0 .274 1.01",key:"gkbcor"}],["circle",{cx:"10",cy:"20",r:"2",key:"1xzdoj"}]]);e.s(["FileArchive",()=>a],8554)},8074,e=>{"use strict";let a=(0,e.i(49163).default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);e.s(["Upload",()=>a],8074)},20483,e=>{"use strict";let a=(0,e.i(49163).default)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);e.s(["X",()=>a],20483)},53609,e=>{"use strict";let a=(0,e.i(49163).default)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);e.s(["Search",()=>a],53609)},33121,e=>{"use strict";let a=(0,e.i(49163).default)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);e.s(["Download",()=>a],33121)},47248,e=>{"use strict";let a=(0,e.i(49163).default)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>a],47248)},2782,e=>{"use strict";var a=e.i(13161),t=e.i(91447),s=e.i(8950),r=e.i(8554),i=e.i(33121),l=e.i(47248),d=e.i(8074),n=e.i(50400),c=e.i(53609),o=e.i(92062),x=e.i(20483),p=e.i(86470);function m(){let[e,m]=(0,t.useState)([]),[h,g]=(0,t.useState)(!0),[y,b]=(0,t.useState)(0),[v,f]=(0,t.useState)(1),[j,N]=(0,t.useState)(1),[w,k]=(0,t.useState)({estado:void 0,search:"",fechaDesde:void 0,fechaHasta:void 0,page:1,limit:20}),[C,S]=(0,t.useState)(!1),[z,A]=(0,t.useState)(null),[E,I]=(0,t.useState)(!1),[M,L]=(0,t.useState)(null),T=async()=>{try{g(!0);let e={...w,search:w.search||void 0,estado:w.estado||void 0,page:v},a=await (0,p.getEvidencias)(e);m(a.evidencias),b(a.total),N(a.totalPages)}catch(e){s.toast.error(e.response?.data?.message||"Error al cargar evidencias")}finally{g(!1)}};(0,t.useEffect)(()=>{T()},[v,w.estado]);let P=()=>{f(1),T()},U=async e=>{try{await (0,p.downloadZip)(e.ventaId._id,e.originalName||"evidencia.zip"),s.toast.success("Descarga iniciada")}catch(e){s.toast.error(e.response?.data?.message||"Error al descargar archivo")}},R=async()=>{if(M)try{let e=await (0,p.markAsComplete)(M.ventaId._id);s.toast.success(e.message),I(!1),L(null),T()}catch(e){s.toast.error(e.response?.data?.message||"Error al marcar como terminada")}},B=e=>"QR hecho"===e.ventaId.status&&"terminada"!==e.estado;return(0,a.jsxs)("div",{className:"p-4 md:p-6 max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("h1",{className:"text-2xl md:text-3xl font-bold text-gray-800 flex items-center gap-2",children:[(0,a.jsx)(r.FileArchive,{className:"text-blue-600",size:32}),"Gestión de Evidencias"]}),(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:"Administra archivos ZIP de evidencias vinculados a ventas"})]}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-6",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-3",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(c.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:18}),(0,a.jsx)("input",{type:"text",placeholder:"Buscar por nombre o CUIL...",value:w.search,onChange:e=>k({...w,search:e.target.value}),onKeyDown:e=>"Enter"===e.key&&P(),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),(0,a.jsxs)("select",{value:w.estado||"",onChange:e=>k({...w,estado:e.target.value||void 0}),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,a.jsx)("option",{value:"",children:"Todos los estados"}),(0,a.jsx)("option",{value:"incompleta",children:"Incompleta"}),(0,a.jsx)("option",{value:"en_proceso",children:"En Proceso"}),(0,a.jsx)("option",{value:"terminada",children:"Terminada"})]}),(0,a.jsxs)("button",{onClick:P,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[(0,a.jsx)(o.Filter,{size:18}),"Aplicar"]}),(0,a.jsxs)("button",{onClick:()=>{k({estado:void 0,search:"",fechaDesde:void 0,fechaHasta:void 0,page:1,limit:20}),f(1)},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 flex items-center gap-2",children:[(0,a.jsx)(x.X,{size:18}),"Limpiar"]})]})}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[h?(0,a.jsx)("div",{className:"p-8 text-center text-gray-500",children:"Cargando evidencias..."}):0===e.length?(0,a.jsx)("div",{className:"p-8 text-center text-gray-500",children:"No se encontraron evidencias"}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-50 border-b border-gray-200",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase",children:"Afiliado"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase",children:"CUIL"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase",children:"Estado Venta"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase",children:"Estado Evidencia"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase",children:"Archivo"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase",children:"Bloqueo"}),(0,a.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-600 uppercase",children:"Acciones"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-200",children:e.map(e=>{var t;return(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.ventaId.nombre}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.ventaId.cuil}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm",children:(0,a.jsx)("span",{className:"px-2 py-1 bg-purple-100 text-purple-700 rounded-full text-xs",children:e.ventaId.status})}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm",children:(t=e.estado,(0,a.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${{incompleta:"bg-gray-100 text-gray-700",en_proceso:"bg-blue-100 text-blue-700",terminada:"bg-green-100 text-green-700"}[t]}`,children:{incompleta:"Incompleta",en_proceso:"En Proceso",terminada:"Terminada"}[t]}))}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.originalName?(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)(r.FileArchive,{size:14}),e.originalName]}):(0,a.jsx)("span",{className:"text-gray-400",children:"Sin archivo"})}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm",children:e.isLocked?(0,a.jsxs)("span",{className:"flex items-center gap-1 text-red-600",children:[(0,a.jsx)(n.Lock,{size:14}),"Bloqueada"]}):(0,a.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm",children:(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>{A(e.ventaId._id),S(!0)},disabled:!!e.isLocked,title:e.isLocked?"No se puede modificar la evidencia porque la venta está en 'QR hecho'.":"Subir/Reemplazar ZIP",className:`p-2 rounded-lg transition-colors ${!e.isLocked?"bg-blue-100 text-blue-600 hover:bg-blue-200":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,children:(0,a.jsx)(d.Upload,{size:16})}),(0,a.jsx)("button",{onClick:()=>{L(e),I(!0)},disabled:!B(e),title:B(e)?"Marcar como Terminada":"Solo disponible cuando la venta esté en 'QR hecho'.",className:`p-2 rounded-lg transition-colors ${B(e)?"bg-green-100 text-green-600 hover:bg-green-200":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,children:(0,a.jsx)(l.CheckCircle,{size:16})}),(0,a.jsx)("button",{onClick:()=>U(e),disabled:!e.filePath,title:e.filePath?"Descargar ZIP":"Sin archivo disponible",className:`p-2 rounded-lg transition-colors ${e.filePath?"bg-indigo-100 text-indigo-600 hover:bg-indigo-200":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,children:(0,a.jsx)(i.Download,{size:16})})]})})]},e._id)})})]})}),j>1&&(0,a.jsxs)("div",{className:"px-4 py-3 border-t border-gray-200 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["Mostrando ",e.length," de ",y," evidencias"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>f(e=>Math.max(1,e-1)),disabled:1===v,className:"px-3 py-1 border border-gray-300 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Anterior"}),(0,a.jsxs)("span",{className:"px-3 py-1 text-sm text-gray-600",children:["Página ",v," de ",j]}),(0,a.jsx)("button",{onClick:()=>f(e=>Math.min(j,e+1)),disabled:v===j,className:"px-3 py-1 border border-gray-300 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Siguiente"})]})]})]}),C&&(0,a.jsx)(u,{ventaId:z,onClose:()=>{S(!1),A(null)},onSuccess:()=>{S(!1),A(null),T()}}),E&&M&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"Confirmar Acción"}),(0,a.jsxs)("p",{className:"text-gray-600 mb-6",children:["¿Confirmas que deseas marcar esta evidencia como ",(0,a.jsx)("strong",{children:"Terminada"}),"? Esta acción no permitirá futuras modificaciones mientras la venta esté en 'QR hecho'."]}),(0,a.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,a.jsx)("button",{onClick:()=>{I(!1),L(null)},className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancelar"}),(0,a.jsx)("button",{onClick:R,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"Confirmar"})]})]})})]})}function u({ventaId:e,onClose:r,onSuccess:i}){let[l,n]=(0,t.useState)(null),[c,o]=(0,t.useState)(!1),[x,m]=(0,t.useState)(0),u=async()=>{if(!l)return void s.toast.error("Selecciona un archivo");try{o(!0),m(50);let a=await (0,p.uploadZip)(e,l);m(100),s.toast.success(a.message),setTimeout(()=>{i()},500)}catch(e){s.toast.error(e.response?.data?.message||"Error al subir archivo"),m(0)}finally{o(!1)}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6",children:[(0,a.jsxs)("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[(0,a.jsx)(d.Upload,{size:20}),"Subir Archivo ZIP"]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Seleccionar archivo"}),(0,a.jsx)("input",{type:"file",accept:".zip",onChange:e=>{let a=e.target.files?.[0];a&&(a.name.toLowerCase().endsWith(".zip")?a.size>0x6400000?s.toast.error("El archivo no debe superar los 100MB"):n(a):s.toast.error("Solo se permiten archivos .zip"))},disabled:c,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Formato: .zip | Tamaño máximo: 100MB"})]}),l&&(0,a.jsxs)("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg",children:[(0,a.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,a.jsx)("strong",{children:"Archivo seleccionado:"})," ",l.name]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["Tamaño: ",(l.size/1024/1024).toFixed(2)," MB"]})]}),c&&(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${x}%`}})}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1 text-center",children:["Subiendo... ",x,"%"]})]}),(0,a.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,a.jsx)("button",{onClick:r,disabled:c,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50",children:"Cancelar"}),(0,a.jsx)("button",{onClick:u,disabled:!l||c,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Subiendo...":"Subir"})]})]})})}e.s(["default",()=>m])}]);